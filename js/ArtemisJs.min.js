/*! ArtemisJs 2014-01-02 */
!function(a,b){"function"==typeof define&&define.amd?define(b):"object"==typeof exports?module.exports=b():a.artemis=b()}(this,function(){function a(){var a=32,b=5,c=[],d=function(a){return a>>b},e=function(a){return 1<<(31&a)},f=function(){return c},g=function(a){if(!(0>a)){var b=d(a);return c[b]=c[b]|e(a),c[b]}},h=function(a){if(!(0>a)){var b=d(a);return c[b]=c[b]&~e(a),c[b]}},i=function(a){if(0>a)return void 0;var b=d(a);return c[b]&e(a)},j=function(){return c.length},k=function(){var a,b=0;for(a=0;a<c.length;a+=1)for(var d=c[a]||0,e=d;0!==e;e&=e-1)b+=1;return b},l=function(a){if(this===a)return this;var b,d=Math.min(j(),a.maxWords()),e=a.getWords();for(b=0;d>b;b+=1)c[b]=(c[b]||0)|(e[b]||0);return d<a.maxWords()&&(c=c.concat(e.slice(d,a.maxWords()))),this},m=function(a){if(this===a)return this;var b,d=Math.min(j(),a.maxWords()),e=a.getWords();for(b=0;d>b;b+=1)c[b]=(c[b]||0)&(e[b]||0);if(d>a.maxWords()){for(var f=Math.max(Math.ceil(a.maxWords()-d),0),g=0,h=new Array(f);f>g;)h[g++]=d,d+=1;for(var i=0;i<h.length;i++)c.pop()}return this},n=function(a){var b,d=Math.min(j(),a.maxWords()),e=a.getWords();for(b=0;d>b;b+=1)c[b]=(c[b]||0)^(e[b]||0);var f;if(d<a.maxWords())for(f=a.maxWords(),b=d;f>b;b+=1)c[b]=0^(e[b]||0);else for(f=j(),b=d;f>b;b+=1)c[b]=0^(c[b]||0);return this},o=function(f){var g=d(f);if(g>=c.length)return-1;var h,i=c[g],k=j();if(i)for(h=31&f;a>h;h+=1)if(i&e(h))return(g<<b)+h;for(g+=1;k>g;g+=1){var l=c[g];if(l)for(h=0;a>h;h+=1)if(0!==(l&e(h)))return(g<<b)+h}return-1},p=function(f){var g=d(f);if(g>=c.length)return-1;var h,i=c[g];if(i)for(h=31&f;h>=0;h-=1)if(i&e(h))return(g<<b)+h;for(g-=1;g>=0;g-=1){var j=c[g];if(j)for(h=a-1;h>=0;h-=1)if(0!==(j&e(h)))return(g<<b)+h}return-1},q=function(a){a=a||10;for(var b=[],d=0;d<c.length;d++)b.push((c[d]||0).toString(a));return"["+b.join(", ")+"]"},r=function(a){for(var b=Math.min(j(),a.maxWords())-1;b>=0;b--)if(c[b]&a.getWords()[b])return!0;return!1},s=function(){return 0===c.length};return{getWords:f,set:g,get:i,clear:h,maxWords:j,cardinality:k,or:l,and:m,xor:n,nextSetBit:o,prevSetBit:p,intersects:r,isEmpty:s,toString:q}}function b(){var a,b,c="";for(a=0;32>a;a++)b=16*Math.random()|0,(8==a||12==a||16==a||20==a)&&(c+="-"),c+=(12==a?4:16==a?3&b|8:b).toString(16);return c}var c=function(a){function b(a){a||(a=Math.ceil(3*c.length/2+1)),c.length=a}var c=[],d=0;c.length=a?a:64;var e=function(a){if(a>=d)return void 0;var b=c[a];return c[a]=c[--d],c[d]=null,b},f=function(){if(d>0){var a=c[--d];return c[d]=null,a}return null},g=function(a){for(var b,e=0;d>e;e++)if(b=c[e],a==b)return c[e]=c[--d],c[d]=null,!0;return!1},h=function(a){for(var b=0;d>b;b++)if(a==c[b])return!0;return!1},i=function(a){for(var b,f=!1,g=0;g<a.size();g++){b=a.get(g);for(var h=0;d>h;h++)if(b==c[h]){e(h),h--,f=!0;break}}return f},j=function(a){return c[a]},k=function(){return d},l=function(){return c.length},m=function(a){return a<l()},n=function(){return 0===d},o=function(a){d===c.length&&b(),c[d++]=a},p=function(a,e){a>=c.length&&b(2*a),a>d&&(d=a+1),c[a]=e},q=function(){for(var a=0;a<c.length;a++)c[a]=null;d=0},r=function(a){for(var b=0;b<a.size();b++)o(a.get(b))};return{add:o,addAll:r,removeByIndex:e,removeLast:f,removeElement:g,removeAll:i,clear:q,get:j,set:p,getCapacity:l,size:k,contains:h,isIndexWithinBounds:m,isEmpty:n}},d=Object.create(Object.prototype);Object.defineProperty(d,"extend",{value:function(){for(var a=Object.hasOwnProperty,b=Object.create(this),c=arguments.length,d=c;d;){var e=arguments[c-d--];for(var f in e)(a.call(e,f)||"undefined"==typeof b[f])&&(b[f]=e[f])}return b},configurable:!1,enumerable:!1,writable:!0});var e=function(){function a(a,b){var c=Array.prototype.slice.call(arguments,2),d=a.extend.apply(a,c);return Object.defineProperty(d,b.name,{value:b.value,configurable:!0,enumerable:!1,writable:!1}),d}return{extendSystem:function(b,c){var d=[];d.length=arguments.length,d[0]=arguments[0],d[1]={name:"systemType",value:c};for(var e=2;e<arguments.length;e++)d.push(arguments[e]);return a.apply(null,d)},extendManager:function(b,c){var d=[];d.length=arguments.length,d[0]=arguments[0],d[1]={name:"managerType",value:c};for(var e=2;e<arguments.length;e++)d.push(arguments[e]);return a.apply(null,d)},extendComponent:function(b,c){var d=[];d.length=arguments.length,d[0]=b,d[1]={name:"componentType",value:c};for(var e=2;e<arguments.length;e++)arguments[e]&&d.push(arguments[e]);return a.apply(null,d)}}}();Math.signum||(Math.signum=function(a){return"number"==typeof a?a?0>a?-1:1:a===a?0:0/0:0/0});var f={_sin_a:-4/this.SQUARED_PI,_sin_b:4/Math.PI,_sin_p:.225,_asin_a:-.048129527683101345,_asin_b:-.3438359939479152,_asin_c:.9627618484259132,_asin_d:1.0013894086010704,SQUARED_PI:Math.PI*Math.PI,HALF_PI:.5*Math.PI,TWO_PI:2*Math.PI,THREE_PI_HALVES:this.TWO_PI-this.HALF_PI,cos:function(a){return this.sin(a+(a>this.HALF_PI?-this.THREE_PI_HALVES:this.HALF_PI))},sin:function(a){return a=this._sin_a*a*Math.abs(a)+this._sin_b*a,this._sin_p*(a*Math.abs(a)-a)+a},tan:function(a){return sin(a)/cos(a)},asin:function(a){return a*(Math.abs(a)*(Math.abs(a)*this._asin_a+this._asin_b)+this._asin_c)+Math.signum(a)*(this._asin_d-Math.sqrt(1-a*a))},acos:function(a){return this.HALF_PI-this.asin(a)},atan:function(a){return Math.abs(a)<1?a/(1+this._atan_a*a*a):Math.signum(a)*this.HALF_PI-a/(a*a+this._atan_a)}},g={_delay:0,_repeat:!1,_acc:0,_done:!1,_stopped:!1,execute:null,create:function(a,b,c){var d=Object.create(this);return d._delay=a,"boolean"==typeof b&&(d._repeat=b),d.execute=c,d},update:function(a){this._done||this._stopped||(this._acc+=a,this._acc>=this._delay&&(this._acc-=this._delay,this._repeat?this.reset():this._done=!0,"function"==typeof this.execute&&this.execute()))},reset:function(){this._stopped=!1,this._done=!1,this._acc=0},isDone:function(){return this._done},isRunning:function(){return!this._done&&this._acc<this._delay&&!this._stopped},stop:function(){this._stopped=!0},setDelay:function(a){this._delay=a},getPercentageRemaining:function(){return this._done?100:this._stopped?0:1-(this._delay-this._acc)/this._delay},getDelay:function(){return this._delay}},h=function(){function b(){var a={};return c.call(a),a}var c=function(){function b(a,b){for(var c=0;c<b.length;c++)a.set(k.getIndexFor(b[c]))}var c=a(),d=a(),e=a();this.getAllSet=function(){return c},this.getExclusionSet=function(){return d},this.getOneSet=function(){return e},this.all=function(){return b(c,arguments),this},this.exclude=function(){return b(d,arguments),this},this.one=function(){return b(e,arguments),this}};return{getAspectForAll:function(){var a=b();return a.all.apply(a,arguments),a},getAspectForOne:function(){var a=b();return a.one.apply(a,arguments),a},getEmpty:function(){return b()}}}(),i=d.extend({create:function(){return Object.create(this)}});Object.defineProperty(i,"componentType",{value:"component",configurable:!0,enumerable:!1,writable:!1});var j=function(){var a=function(a,b){var c=k.getTypeFor(a),d=b.getComponentManager().getComponentsByType(c);this.get=function(a){return d.get(a.getId())},this.getSafe=function(a){return d.isIndexWithinBounds(a.getId())?d.get(a.getId()):null},this.has=function(a){return d.isIndexWithinBounds(a.getId())}};return{getFor:function(b,c){var d={};return a.call(d,b,c),d}}}(),k=function(){function a(){var a=b++;return{getIndex:function(){return a}}}var b=0,c=Object.create(null);return{getTypeFor:function(b){var d=c[b];return d||(d=a(),c[b]=d),d},getIndexFor:function(a){return this.getTypeFor(a).getIndex()}}}(),l=function(){var c=function(c,d){var e,f=a(),g=a(),h=c.getEntityManager(),i=c.getComponentManager();this.reset=function(){f.clear(),g.clear(),e=b()},this.getId=function(){return d},this.getComponentBits=function(){return f},this.getSystemBits=function(){return g},this.getUuid=function(){return e},this.getWorld=function(){return c},this.addComponent=function(a,b){var c=b;return c||(c=k.getTypeFor(a.componentType)),i.addComponent(this,c,a),this},this.removeComponent=function(a){return this.removeComponentByType(a.componentType)},this.removeComponentByType=function(a){var b=a;return"string"==typeof b&&(b=k.getTypeFor(b)),i.removeComponent(this,b),this},this.isActive=function(){return h.isActive(d)},this.isEnabled=function(){return h.isEnabled(d)},this.getComponent=function(a){var b=a;return"string"==typeof b&&(b=k.getTypeFor(b)),i.getComponent(this,b)},this.getComponents=function(a){return i.getComponentsFor(this,a)},this.addToWorld=function(){c.addEntity(this)},this.changedInWorld=function(){c.changedEntity(this)},this.deleteFromWorld=function(){c.deleteEntity(this)},this.enable=function(){c.enable(this)},this.disable=function(){c.disable(this)}},d={create:function(a,b){var d=Object.create(this);return c.call(d,a,b),d.reset(),d}};return d}(),m=d.extend({added:function(){},changed:function(){},deleted:function(){},enabled:function(){},disabled:function(){}}),n=function(){var a=function(){var a=0,b=Object.create(null);return{getIndexFor:function(c){if(!c)return-1;var d=b[c];return d||(d=a++,b[c]=d),d}}}(),b=function(b){function d(){this.checkProcessing()&&(this.begin(),this.processEntities(k),this.end())}function e(a){k.removeElement(a),a.getSystemBits().clear(j),this.removed(a)}function f(a){k.add(a),a.getSystemBits().set(j),this.inserted(a)}function g(a){if(!o){var b=a.getSystemBits().get(j),c=!0,d=a.getComponentBits();if(!l.isEmpty())for(var g=l.nextSetBit(0);g>=0;g=l.nextSetBit(g+1))if(!d.get(g)){c=!1;break}!m.isEmpty()&&c&&(c=!m.intersects(d)),n.isEmpty()||(c=n.intersects(d)),c&&!b?f.call(this,a):!c&&b&&e.call(this,a)}}function h(a){a.getSystemBits().get(j)&&e.call(this,a)}var i,j=a.getIndexFor(this.systemType),k=c(),l=b.getAllSet(),m=b.getExclusionSet(),n=b.getOneSet(),o=l.isEmpty()&&n.isEmpty(),p=!1;this.isPassive=function(){return p},this.setPassive=function(a){p=a},this.getActives=function(){return k},this.process=d,this.check=g,this.added=g,this.changed=g,this.deleted=h,this.disabled=h,this.enabled=g,this.setWorld=function(a){i=a},this.getWorld=function(){return i}},f=e.extendSystem(d,"entitySystem",m,{create:function(a){var c=Object.create(this);return b.call(c,a),c},inserted:function(){},removed:function(){},initialize:function(){},begin:function(){},end:function(){},checkProcessing:function(){return!1},processEntities:function(){throw{NotImplemented:"Not supported yet. Override processEntities when extending"}}});return f}(),o=d.extend(m,{initialize:function(){},setWorld:function(a){this.world=a},getWorld:function(){return this.world}});Object.defineProperty(o,"managerType",{value:"manager",configurable:!0,enumerable:!1,writable:!1});var p=function(){var a=function(){function a(a){for(var c=a.getComponentBits(),d=c.nextSetBit(0);d>=0;d=c.nextSetBit(d+1))b.get(d).set(a.getId(),null);c.clear()}var b=c(),d=c();this.addComponent=function(a,b,c){var d=this.getComponentsByType(b);d.set(a.getId(),c),a.getComponentBits().set(b.getIndex())},this.removeComponent=function(a,c){var d=a.getComponentBits();d.get(c.getIndex())&&(b.get(c.getIndex()).set(a.getId(),null),d.clear(c.getIndex()))},this.getComponentsByType=function(a){var d=b.get(a.getIndex());return d||(d=c(),b.set(a.getIndex(),d)),d},this.getComponent=function(a,c){var d=b.get(c.getIndex());return d?d.get(a.getId()):null},this.getComponentsFor=function(a,c){for(var d=a.getComponentBits(),e=d.nextSetBit(0);e>=0;e=d.nextSetBit(e+1))c.add(b.get(e).get(a.getId()));return c},this.deleted=function(a){d.add(a)},this.clean=function(){if(d.size()>0){for(var b=0;d.size()>b;b++)a(d.get(b));d.clear()}}},b=e.extendManager(o,"componentManager",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),q=function(){var b=function(){var a=c(),b=0;return{checkOut:function(){return a.size()>0?a.removeLast():b++},checkIn:function(b){a.add(b)}}},d=function(){var d=c(),e=a(),f=0,g=0,h=0,i=0,j=b();this.createEntityInstance=function(){var a=l.create(this.getWorld(),j.checkOut());return h++,a},this.added=function(a){f++,g++,d.set(a.getId(),a)},this.enabled=function(a){e.clear(a.getId())},this.disabled=function(a){e.set(a.getId())},this.deleted=function(a){d.set(a.getId(),null),e.clear(a.getId()),j.checkIn(a.getId()),f--,i++},this.isActive=function(a){return d.get(a)?!0:!1},this.isEnabled=function(a){return!e.get(a)},this.getEntity=function(a){return d.get(a)},this.getActiveEntityCount=function(){return f},this.getTotalCreated=function(){return h},this.getTotalAdded=function(){return g},this.getTotalDeleted=function(){return i}},f=e.extendManager(o,"entityManager",{create:function(){var a=Object.create(this);return d.call(a),a}});return f}(),r=function(){var a=function(){function a(a){var b=e[a.getUuid()];if(b){for(var c,f=0;f<b.size();f++)c=d[b.get(f)],c&&c.removeElement(a);b.clear()}}function b(a){var b=e[a.getUuid()];return b&&!b.isEmpty()}var d=Object.create(null),e=Object.create(null);this.add=function(a,b){var f=d[b];f||(f=c(),d[b]=f),f.add(a);var g=e[a.getUuid()];g||(g=c(),e[a.getUuid()]=g),g.add(b)},this.remove=function(a,b){var c=d[b];c&&c.removeElement(a);var f=e[a.getUuid()];f&&f.removeElement(b)},this.removeFromAllGroups=a,this.getEntities=function(a){var b=d[a];return b||(b=c(),d[a]=b),b},this.getGroups=function(a){return b(a)?e[a.getUuid()]:null},this.isInAnyGroup=b,this.isInGroup=function(a,b){var c=e[a.getUuid()];return c&&c.contains(b)},this.deleted=function(b){a(b)}},b=e.extendManager(o,"groupManager",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),s=function(){var a=function(){function a(a){var c=b[a.getUuid()];if(c){var e=d[c];e&&e.removeElement(a)}}var b=Object.create(null),d=Object.create(null);this.setPlayer=function(a,e){b[a.getUuid()]=e;var f=d[e];f||(f=c(),d[e]=f),f.add(a)},this.getEntitiesOfPlayer=function(a){var b=d[a];return b||(b=c(),d[a]=b),b},this.removeFromPlayer=a,this.getPlayer=function(a){return b[a.getUuid()]},this.deleted=function(b){a(b)}},b=e.extendManager(o,"playerManager",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),t=function(){var a=function(){var a=Object.create(Object.prototype),b=Object.create(null);this.register=function(c,d){a[c]=d,b[d.getUuid()]=c},this.unregister=function(c){var d=a[c];delete a[c],delete b[d.getUuid()]},this.isRegistered=function(b){return a[b]?!0:!1},this.getEntity=function(b){return a[b]},this.getRegisteredTags=function(){var b=[];for(var c in a)a.hasOwnProperty(c)&&b.push(c);return b},this.deleted=function(c){var d=b[c.getUuid()];delete b[c.getUuid()],null!==d&&delete a[d]}},b=e.extendManager(o,"tagManager",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),u=function(){var a=function(){function a(a){var c=d[a];if(delete d[a],!c){var e=b[c];e||e.removeElement(a)}}var b=Object.create(null),d=Object.create(null);this.getTeam=function(a){return d[a]},this.setTeam=function(e,f){a(e),d[e]=f;var g=b[f];g||(g=c(),b[f]=g),g.add(e)},this.getPlayers=function(a){return b[a]},this.removeFromTeam=a},b=e.extendManager(o,"managerType",{create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),v=function(){var a=function(){var a=0,b=!1,c=0;this.restart=function(d){a=d,c=0,b=!0},this.offerDelay=function(a){(!b||a<this.getRemainingTimeUntilProcessing())&&this.restart(a)},this.getRemainingTimeUntilProcessing=function(){return b?a-c:0},this.stop=function(){b=!1,c=0},this.inserted=function(a){var b=this.getRemainingDelay(a);b>0&&this.offerDelay(b)},this.getInitialTimeDelay=function(){return a},this.isRunning=function(){return b},this.processEntities=function(a){for(var b,d,e=0;e<a.size();e++)b=a.get(e),this.processDelta(b,c),d=this.getRemainingDelay(b),0>=d?this.processExpired(b):this.offerDelay(d);c=0,0===a.size()&&this.stop()},this.checkProcessing=function(){return b&&(c+=this.getWorld().getDelta(),c>=a)?!0:!1}},b=e.extendSystem(n,"delayedEntityProcessingSystem",{create:function(b){var c=n.create.call(this,b);return a.call(c),c},getRemainingDelay:function(){throw{NotImplemented:"Not supported yet. Override getRemainingDelay when extending"}},processDelta:function(){throw{NotImplemented:"Not supported yet. Override processDelta when extending"}},processExpired:function(){throw{NotImplemented:"Not supported yet. Override processExpired when extending"}}});return b}(),w=e.extendSystem(n,"entityProcessingSystem",{create:function(a){var b=n.create.call(this,a);return b},processEntity:function(){throw{NotImplemented:"Not supported yet. Override process when extending"}},processEntities:function(a){for(var b=0;b<a.size();b++)this.processEntity(a.get(b))},checkProcessing:function(){return!0}}),x=e.extendSystem(w,"intervalEntityProcessingSystem",{create:function(a,b){var c=w.create.call(this,a);return c=y.create.call(c,a,b)}}),y=function(){var a=function(a){var b=0;this.checkProcessing=function(){return b+=this.getWorld().getDelta(),b>=a?(b-=a,!0):!1}},b=e.extendSystem(n,"intervalEntitySystem",{create:function(b,c){var d=n.create.call(this,b);return a.call(d,c),d}});return b}(),z=e.extendSystem(n,"voidEntitySystem",{create:function(){var a=n.create.call(this,h.getEmpty());return a},processSystem:function(){throw{NotImplemented:"Not supported yet. Override processSystem when extending"}},processEntities:function(){this.processSystem.call(this)},checkProcessing:function(){return!0}}),A=function(){var a=function(){function a(a,b){if(a.__componentTypes){var c=a.__componentTypes;if("string"==typeof c&&(c=[c]),!Array.isArray(c)||0===c.length)return;for(var d,e=0;e<c.length;e++){d=c[e];var f=b.getMapper(d);Object.defineProperty(a,d+"Mapper",{value:f,configurable:!1,enumerable:!0,writable:!1})}}}function b(a,b,c){for(var d,e=0;e<a.size();e++)d=a.get(e),d[c]&&d[c].call(d,b)}function d(a,c){if(!a.isEmpty()){for(var d,e=0;e<a.size();e++)d=a.get(e),b(o,d,c),b(q,d,c);a.clear()}}var e=B.entityManager.create(),f=B.componentManager.create(),g=0,h=c(),i=c(),k=c(),l=c(),m=c(),n=Object.create(null),o=c(),p=Object.create(null),q=c();this.initialize=function(){for(var b,c=0;c<o.size();c++)b=o.get(c),b.initialize.call(b);var d;for(c=0;c<q.size();c++)d=q.get(c),a(d,this),d.initialize.call(d)},this.getEntityManager=function(){return e},this.getComponentManager=function(){return f},this.setManager=function(a){return n[a.managerType]=a,o.add(a),a.setWorld(this),a},this.getManager=function(a){return n[a]},this.deleteManager=function(a){delete n[a.managerType],o.removeElement(a)},this.getDelta=function(){return g},this.setDelta=function(a){g=a},this.addEntity=function(a){h.add(a)},this.changedEntity=function(a){i.add(a)},this.deleteEntity=function(a){k.contains(a)||k.add(a)},this.enable=function(a){l.add(a)},this.disable=function(a){m.add(a)},this.createEntity=function(){return e.createEntityInstance()},this.getEntity=function(a){return e.getEntity(a)},this.getSystems=function(){return q},this.setSystem=function(a,b){return a.setWorld(this),a.setPassive(b),p[a.systemType]=a,q.add(a),a},this.deleteSystem=function(a){delete p[a.systemType],q.removeElement(a)},this.getSystem=function(a){return p[a]},this.getMapper=function(a){return j.getFor(a,this)},this.process=function(){d(h,"added"),d(i,"changed"),d(m,"disabled"),d(l,"enabled"),d(k,"deleted"),f.clean();for(var a,b=0;b<q.size();b++)a=q.get(b),a.isPassive()||a.process.call(a)},this.setManager(e),this.setManager(f)},b=d.extend({create:function(){var b=Object.create(this);return a.call(b),b}});return b}(),B={bag:c,bitSet:a,fastMath:f,timer:g,ExtendHelper:e,world:A,manager:o,entity:l,entityManager:q,entityObserver:m,entitySystem:n,component:i,componentManager:p,Aspect:h,ComponentMapper:j,ComponentType:k,groupManager:r,playerManager:s,tagManager:t,teamManager:u,delayedEntityProcessingSystem:v,entityProcessingSystem:w,intervalEntitySystem:y,intervalEntityProcessingSystem:x,voidEntitySystem:z};return B});